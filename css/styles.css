/* Parallax — main stylesheet */
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#f4f7ff;--panel:#ffffff;--panel-soft:#eef2ff;--panel-alt:#f8fafc;
  --border:#cfd8ee;--muted:#3a4764;--text:#0f172a;--accent:#1d4ed8;--accent-fg:#ffffff;
  --control-border:#94a3b8;--danger-bg:#7f1d1d;--danger-border:#ef4444;--danger-text:#ffffff;
  --generation-left-width:1fr;
  --vignette:rgba(160,185,240,0.85);
}
html[data-theme="dark"]{
  --bg:#0b1020;--panel:#111827;--panel-soft:#1e293b;--panel-alt:#0f172a;
  --border:#334155;--muted:#cbd5e1;--text:#f8fafc;--accent:#60a5fa;--accent-fg:#0b1020;
  --control-border:#64748b;--danger-bg:#7f1d1d;--danger-border:#f87171;--danger-text:#ffffff;
  --vignette:rgba(0,0,0,0.95);
}
html[data-theme="contrast"]{
  --bg:#000000;--panel:#000000;--panel-soft:#000000;--panel-alt:#000000;
  --border:#ffffff;--muted:#ffffff;--text:#ffffff;--accent:#00ffff;--accent-fg:#000000;
  --control-border:#ffffff;--danger-bg:#000000;--danger-border:#ffff00;--danger-text:#ffff00;
  --vignette:transparent;
}
body{background:var(--bg);color:var(--text);font-family:'Courier New',monospace;min-height:100vh;line-height:1.4;display:flex;flex-direction:column;overflow:hidden;height:100vh}
a{color:var(--accent)}
#main-tabs{position:sticky;top:0;z-index:1000;display:flex;justify-content:space-between;align-items:center;gap:12px;padding:10px 14px;background:var(--panel);border-bottom:1px solid var(--border);flex-shrink:0}
body.plot-zen #main-tabs{display:none}
.tabs-left{display:flex;gap:8px;align-items:center}
.tab-btn{background:var(--panel-soft);border:1px solid var(--control-border);color:var(--text);font-family:'Courier New',monospace;font-size:12px;letter-spacing:.5px;padding:8px 12px;border-radius:6px;cursor:pointer}
.tab-btn.active{border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 2px #60a5fa55}
.tabs-right{display:flex;gap:8px;align-items:center}
.tabs-right select{width:170px;font-size:13px;padding:8px 10px}
#plot-panel{flex:1;min-height:0;display:flex;flex-direction:column}
#setup{width:100%;max-width:none;margin:0;padding:24px;display:flex;flex-direction:column;gap:20px;flex:1;overflow-y:auto}
.setup-section-stack{display:flex;flex-direction:column;gap:12px}
.setup-section{border:1px solid var(--border);border-radius:8px;background:var(--panel-alt);overflow:hidden}
.setup-section>summary{list-style:none;display:flex;justify-content:space-between;align-items:center;gap:8px;padding:12px 14px;cursor:pointer;font-size:12px;letter-spacing:.8px;color:var(--muted);background:var(--panel-soft)}
.setup-section>summary::-webkit-details-marker{display:none}
.setup-section[open]>summary{color:var(--accent);border-bottom:1px solid var(--border)}
.setup-section-body{display:flex;flex-direction:column;gap:12px;padding:14px}
.setup-help{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border:1px solid var(--control-border);border-radius:999px;font-size:11px;color:var(--muted);cursor:help}
.logo{font-size:11px;letter-spacing:3px;color:var(--muted);margin-bottom:4px}
h1{font-size:30px;color:var(--accent);letter-spacing:1px;line-height:1.2}
.sub{font-size:14px;color:var(--muted);letter-spacing:1px;margin-top:6px}
.workflow-card{border:1px solid var(--border);border-radius:8px;background:var(--panel);padding:12px;display:flex;flex-direction:column;gap:8px}
.workflow-title{font-size:12px;letter-spacing:.8px;color:var(--accent)}
.workflow-list{margin:0;padding-left:18px;display:flex;flex-direction:column;gap:6px}
.workflow-list li{font-size:12px;line-height:1.45;color:var(--muted)}
.workflow-note{font-size:12px;color:var(--muted);line-height:1.5}
.field-group{display:flex;flex-direction:column;gap:8px}
label{font-size:12px;letter-spacing:1px;color:var(--muted)}
input[type=text],input[type=password],input[type=number],select,textarea{background:var(--panel);border:1px solid var(--border);color:var(--text);font-family:'Courier New',monospace;font-size:16px;padding:12px 14px;border-radius:6px;width:100%;outline:none;transition:border-color .2s}
input[type=text]:focus,input[type=password]:focus,input[type=number]:focus,select:focus,textarea:focus{border-color:var(--accent)}
.api-row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.prefs-row{display:grid;grid-template-columns:1fr 220px;gap:8px;align-items:center}
.prefs-row-single{grid-template-columns:1fr}
.prefs-row-wide{display:grid;grid-template-columns:1fr 1fr;gap:8px;align-items:center}
.mini-grid{display:grid;grid-template-columns:120px 1fr;gap:8px;align-items:center}
.lens-gen-row{display:grid;grid-template-columns:130px 1fr;gap:8px;align-items:center}
.api-key-row{display:flex;gap:8px}.api-key-row input{flex:1}
.mini-btn{background:var(--panel-soft);border:1px solid var(--control-border);color:var(--text);font-family:'Courier New',monospace;font-size:12px;letter-spacing:.5px;padding:0 12px;border-radius:6px;cursor:pointer;white-space:nowrap;position:relative;overflow:hidden}
.mini-btn:hover{border-color:var(--accent);color:var(--accent)}
.mini-btn.llm-busy{pointer-events:none;border-color:var(--accent);color:var(--accent)}
.mini-btn.llm-busy::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent 0%,var(--accent) 50%,transparent 100%);animation:probe-shimmer 1.5s ease-in-out infinite}
.tiny-note{font-size:12px;color:var(--muted);line-height:1.5}
.toggle-wrap{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--panel);border:1px solid var(--border);border-radius:6px;color:var(--text)}
.toggle-wrap input[type=checkbox]{width:18px;height:18px;accent-color:var(--accent)}
.toggle-wrap label{margin:0;font-size:13px;letter-spacing:.4px;color:var(--muted)}
.disc-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.disc-row{display:flex;align-items:center;gap:8px}
.disc-num{font-size:12px;color:var(--muted);width:18px;flex-shrink:0}
.disc-color{width:8px;height:8px;border-radius:2px;flex-shrink:0}
input.disc-input{flex:1;font-size:15px;padding:10px 12px}
.probe-del-btn{height:40px;padding:0 10px}
.probe-actions{display:flex;gap:8px;margin-top:6px}
.launch-btn{background:var(--accent);border:1px solid var(--accent);color:var(--accent-fg);font-family:'Courier New',monospace;font-size:14px;letter-spacing:1px;padding:14px 28px;cursor:pointer;border-radius:6px;transition:all .2s;align-self:flex-start}
.launch-btn:hover{filter:brightness(.92)}
.note{font-size:14px;color:var(--muted);line-height:1.7}
.prompt-workbench{display:grid;grid-template-columns:minmax(320px,var(--generation-left-width)) 10px minmax(320px,1fr);gap:10px;align-items:stretch}
.prompt-pane{border:1px solid var(--border);border-radius:8px;background:var(--panel-alt);padding:10px;display:flex;flex-direction:column;gap:8px;min-height:260px}
.prompt-workbench > .prompt-pane:not(#workbench-controls-pane){order:3}
#workbench-controls-pane{order:1}
.prompt-pane-title{font-size:11px;letter-spacing:.7px;color:var(--accent)}
.prompt-preview-controls{display:grid;grid-template-columns:1fr 1fr auto;gap:8px;align-items:end}
.compact-field{gap:4px}
.compact-field label{font-size:10px;letter-spacing:.7px}
.prompt-kind-help{font-size:12px;line-height:1.45;color:var(--muted);background:var(--panel);border:1px solid var(--border);border-radius:6px;padding:8px 10px}
.prompt-preview-disc-wrap-disabled{opacity:.68}
.prompt-readonly{min-height:180px;resize:vertical;font-size:12px;line-height:1.45}
.prompt-params{min-height:120px;resize:vertical;font-size:12px;line-height:1.45}
.prompt-editable{min-height:160px;resize:vertical;font-size:12px;line-height:1.45}
.prompt-status{font-size:12px;padding:8px 10px}
.prompt-override-summary{font-size:12px;line-height:1.45;color:var(--muted);border:1px dashed var(--border);border-radius:6px;padding:8px 10px;background:var(--panel)}
.prompt-override-chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
.prompt-override-chip{font-size:10px;letter-spacing:.4px;border:1px solid var(--control-border);border-radius:999px;padding:2px 8px;color:var(--muted);background:var(--panel-soft)}
.madlibs-grid{display:grid;grid-template-columns:1fr;gap:8px}
.madlibs-grid textarea{min-height:72px;resize:vertical}
.prompt-workbench.resizing{user-select:none;cursor:col-resize}
#workbench-resizer{width:10px;cursor:col-resize;position:relative;background:transparent}
#workbench-resizer{order:2}
#workbench-resizer::before{content:"";position:absolute;left:4px;top:0;bottom:0;width:2px;background:var(--border)}
#workbench-resizer:hover::before,.prompt-workbench.resizing #workbench-resizer::before{background:var(--accent)}
#workbench-resizer:focus-visible{outline:none;box-shadow:inset 0 0 0 2px #60a5fa66}
.controls-pane{max-height:680px;overflow:auto;scrollbar-gutter:stable both-edges;padding-bottom:2px}
.workbench-sticky-nav{position:sticky;top:-1px;z-index:4;background:var(--panel-alt);border:1px solid var(--border);border-radius:8px;padding:6px;display:flex;flex-wrap:wrap;gap:6px}
.workbench-control-stack{display:flex;flex-direction:column;gap:10px}
.workbench-section{border:1px solid var(--border);border-radius:8px;background:var(--panel);padding:10px;display:flex;flex-direction:column;gap:8px}
fieldset.workbench-section{min-width:0;position:relative}
.workbench-section-title{font-size:11px;letter-spacing:.7px;color:var(--accent)}
legend.workbench-section-title{padding:0 4px}
.workbench-advanced{padding:0}
.workbench-advanced > summary{list-style:none;cursor:pointer;padding:10px}
.workbench-advanced > summary::-webkit-details-marker{display:none}
.workbench-advanced-body{display:flex;flex-direction:column;gap:8px;padding:0 10px 10px}
.readiness-list{display:flex;flex-direction:column;gap:6px;padding-left:18px}
.readiness-list li{font-size:12px;line-height:1.45;color:var(--muted)}
.readiness-list li.ready{color:#16a34a}
.readiness-list li.warn{color:#d97706}
.readiness-list li.blocked{color:#dc2626}
.run-readiness-status{font-size:12px;letter-spacing:.4px;padding:8px 10px;border-radius:6px;border:1px solid var(--border);background:var(--panel-soft);color:var(--muted)}
.run-readiness-status.ready{border-color:#16a34a;color:#166534;background:#16a34a1c}
.run-readiness-status.blocked{border-color:#dc2626;color:#991b1b;background:#dc26261a}
.run-action-strip{position:sticky;bottom:-10px;z-index:3;background:linear-gradient(180deg,rgba(0,0,0,0) 0%,var(--panel) 20%);padding:10px 0 0;border-top:1px solid var(--border);margin-top:4px}
.workbench-jump-highlight{box-shadow:0 0 0 2px #60a5fa66}
#progress{display:none;max-width:760px;margin:0 auto;padding:48px 24px;flex-direction:column;gap:20px}
.prog-title{font-size:20px;color:var(--accent);letter-spacing:1px}
.prog-target{font-size:15px;color:var(--muted);letter-spacing:.5px;margin-top:6px}
.probe-list{display:flex;flex-direction:column;gap:8px}
.probe-item{display:flex;align-items:center;gap:12px;background:var(--panel);border:1px solid var(--border);padding:12px 14px;border-radius:6px;transition:border-color .3s;position:relative;overflow:hidden}
.probe-item.running{border-color:#7cb9ff44}.probe-item.done{border-color:#00ff9f44}.probe-item.error{border-color:#ff444444}
.probe-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;transition:background .3s}
.probe-dot.idle{background:#222}.probe-dot.running{background:#7cb9ff;animation:pulse 1s infinite}.probe-dot.done{background:#00ff9f}.probe-dot.error{background:#ff4444}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.probe-name{font-size:14px;flex:1}.probe-status{font-size:12px;color:var(--muted);letter-spacing:.5px}
.probe-item.running .probe-status{color:#7cb9ff}.probe-item.done .probe-status{color:#00ff9f}.probe-item.error .probe-status{color:#ff4444}
.synth-bar{background:var(--panel);border:1px solid var(--border);padding:12px 14px;border-radius:6px;font-size:14px;color:var(--muted);letter-spacing:.5px;transition:border-color .3s,color .3s}
.synth-bar.running{border-color:#ffd70044;color:#ffd700;position:relative;overflow:hidden}.synth-bar.done{border-color:#ffd70088;color:#ffd700}.synth-bar.error{border-color:#ff444488;color:#ff8888}
.synth-bar.running::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent 0%,#ffd700 50%,transparent 100%);animation:probe-shimmer 1.5s ease-in-out infinite}
/* Per-probe progress shimmer */
.probe-progress-track{position:absolute;bottom:0;left:0;right:0;height:3px;background:transparent;overflow:hidden;border-radius:0 0 6px 6px}
.probe-progress-fill{height:100%;width:0%;border-radius:0 0 6px 6px}
.probe-item.running .probe-progress-fill{width:100%;background:linear-gradient(90deg,transparent 0%,#7cb9ff 50%,transparent 100%);animation:probe-shimmer 1.5s ease-in-out infinite}
.probe-item.done .probe-progress-fill{width:100%;background:#00ff9f;animation:none}
.probe-item.error .probe-progress-fill{width:100%;background:#ff4444;animation:none}
@keyframes probe-shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
/* Overall progress bar */
.overall-progress{display:flex;flex-direction:column;gap:6px}
.overall-progress-label{font:12px/1 'Courier New',monospace;color:var(--muted);letter-spacing:.5px}
.overall-progress-track{height:4px;background:var(--border);border-radius:2px;overflow:hidden}
.overall-progress-fill{height:100%;width:0%;background:var(--accent);border-radius:2px;transition:width .4s ease}
#viz{display:none;flex:1;min-height:0;flex-direction:column}
#viz-topbar{padding:12px 18px;border-bottom:1px solid var(--border);background:var(--panel);display:flex;justify-content:space-between;align-items:center;flex-shrink:0;z-index:100}
#viz-topbar-left{font-size:14px;color:var(--accent);letter-spacing:1px}
#viz-topbar-right{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.reset-btn{background:var(--panel);border:1px solid var(--control-border);color:var(--text);font-family:'Courier New',monospace;font-size:12px;letter-spacing:.5px;padding:6px 12px;cursor:pointer;border-radius:6px}
#viz-body{flex:1;display:flex;min-height:0}
body.plot-zen .panel-trigger,body.plot-zen .floating-panel,body.plot-zen .panel-hint{display:none}
.sec-label{font-size:11px;letter-spacing:.5px;color:var(--muted);margin-bottom:8px}
.disc-btn{cursor:pointer;display:flex;align-items:center;gap:8px;padding:4px;border-radius:3px;transition:opacity .2s;user-select:none}.disc-btn.off{opacity:.2}
.disc-btn-dot{width:10px;height:10px;border-radius:2px;flex-shrink:0}.disc-btn-abbr{font-size:13px;font-weight:bold}
.disc-btn-name{font-size:13px;color:var(--muted);flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}
.type-btn{cursor:pointer;display:flex;gap:8px;padding:4px;border-radius:3px;transition:opacity .2s;user-select:none}.type-btn.off{opacity:.2}
#detail{background:var(--panel-alt);border-radius:6px;padding:12px;border:1px solid var(--border);font-size:14px}
#detail h3{font-size:16px;color:var(--text);margin-bottom:8px;line-height:1.35}
.detail-type{font-size:12px;letter-spacing:.5px;margin-bottom:6px}.detail-desc{font-size:13px;color:var(--muted);line-height:1.6;margin-bottom:10px}
.dtags{display:flex;flex-wrap:wrap;gap:6px}.dtag{padding:3px 8px;border-radius:4px;font-size:12px}
#stats{margin-top:auto;border-top:1px solid var(--border);padding-top:10px}.stat-row{display:flex;justify-content:space-between;padding:3px 0;font-size:12px}
#plot-wrap{flex:1;min-width:0;min-height:0;display:flex;flex-direction:column;position:relative}#plot{flex:1;min-height:0;width:100%;height:100%}
#plot-vignette{position:fixed;inset:0;background:radial-gradient(ellipse at 50% 50%,transparent 42%,var(--vignette) 100%);pointer-events:none;z-index:450}
/* Floating panels */
.floating-panel{position:fixed;z-index:500;background:var(--panel);border:1px solid var(--border);box-shadow:0 8px 32px #00000033;display:flex;flex-direction:column;pointer-events:auto}
.floating-panel-header{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid var(--border);flex-shrink:0}
.floating-panel-title{font-size:11px;letter-spacing:.5px;color:var(--accent)}
.floating-panel-close{background:transparent;border:none;color:var(--muted);font-size:18px;cursor:pointer;padding:0 4px;line-height:1}.floating-panel-close:hover{color:var(--text)}
.floating-panel-body{overflow-y:auto;padding:14px;flex:1;display:flex;flex-direction:column;gap:18px}
/* Controls panel: slides in from left */
#controls-panel{left:0;top:0;bottom:0;width:320px;border-radius:0 8px 8px 0;border-left:none;transform:translateX(-100%);transition:transform .35s cubic-bezier(0.34,1.56,0.64,1)}
#controls-panel.panel-open{transform:translateX(0)}
/* Term detail panel: slides in from right */
#term-detail-panel{right:20px;top:60px;width:360px;max-height:calc(100vh - 80px);border-radius:8px;transform:translateX(20px);opacity:0;transition:transform .3s cubic-bezier(0.34,1.56,0.64,1),opacity .2s ease;pointer-events:none}
#term-detail-panel.panel-open{transform:translateX(0);opacity:1;pointer-events:auto}
/* Diagnostics panel: slides up from bottom */
#diagnostics-panel{bottom:0;left:50%;transform:translateX(-50%) translateY(100%);width:min(640px,90vw);max-height:55vh;border-radius:8px 8px 0 0;border-bottom:none;transition:transform .35s cubic-bezier(0.34,1.56,0.64,1)}
#diagnostics-panel.panel-open{transform:translateX(-50%) translateY(0)}
/* Panel triggers: semicircle edge buttons */
.panel-trigger{position:fixed;z-index:510;background:var(--accent);border:none;cursor:pointer;color:var(--accent-fg);font-size:16px;display:flex;align-items:center;justify-content:center;padding:0;transition:width .25s ease,height .25s ease,border-radius .25s ease,transform .25s ease;user-select:none}
.trigger-left{left:0;top:50%;width:24px;height:60px;border-radius:0 50% 50% 0;transform:translateY(-50%)}
.trigger-left:hover{width:44px;height:44px;border-radius:50%;transform:translateY(-50%) translateX(8px)}
.trigger-bottom{bottom:0;left:50%;width:60px;height:24px;border-radius:50% 50% 0 0;transform:translateX(-50%)}
.trigger-bottom:hover{width:44px;height:44px;border-radius:50%;transform:translateX(-50%) translateY(-8px)}
.trigger-arrow{display:inline-block;transition:transform .3s ease}
.trigger-left.panel-open .trigger-arrow{transform:rotate(180deg)}
.trigger-bottom.panel-open .trigger-arrow{transform:rotate(180deg)}
/* Onboarding hint tags */
@keyframes hint-bounce-x{0%,100%{transform:translateX(0)}40%{transform:translateX(6px)}70%{transform:translateX(3px)}}
@keyframes hint-bounce-y{0%,100%{transform:translateX(-50%) translateY(0)}40%{transform:translateX(-50%) translateY(-6px)}70%{transform:translateX(-50%) translateY(-3px)}}
.panel-hint{position:fixed;z-index:509;background:var(--accent);color:var(--accent-fg);font-family:'Courier New',monospace;font-size:11px;letter-spacing:.5px;padding:4px 10px;border-radius:999px;pointer-events:none;white-space:nowrap}
#controls-hint{left:28px;top:50%;transform:translateY(-50%);animation:hint-bounce-x 2s ease-in-out infinite}
#diagnostics-hint{bottom:28px;left:50%;transform:translateX(-50%);animation:hint-bounce-y 2s ease-in-out infinite}
#plot-nav-hint{bottom:56px;left:50%;transform:translateX(-50%);background:transparent;color:var(--muted);border:1px solid var(--border);font-size:10px;animation:none}
#toast{display:none;position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:var(--danger-bg);border:1px solid var(--danger-border);color:var(--danger-text);padding:12px 20px;border-radius:6px;font-size:13px;letter-spacing:.3px;z-index:999}
.modal{display:none;position:fixed;inset:0;background:#0008;z-index:1200;align-items:center;justify-content:center;padding:24px}
.modal-card{width:min(900px,95vw);max-height:85vh;overflow:auto;background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:14px}
.modal-top{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:10px}
.modal-title{font-size:14px;color:var(--accent);letter-spacing:.5px}
.mono-block{white-space:pre-wrap;font-size:13px;line-height:1.6;color:var(--text);background:var(--panel-alt);border:1px solid var(--border);padding:10px;border-radius:6px}
.card-list{display:flex;flex-direction:column;gap:10px}
.evidence-card{background:var(--panel-alt);border:1px solid var(--border);border-radius:8px;padding:10px;display:flex;flex-direction:column;gap:6px}
.evidence-card.compact{padding:8px;gap:5px}
.evidence-top{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
.evidence-title{font-size:13px;color:var(--text);font-weight:bold}
.evidence-card.compact .evidence-title{font-size:12px}
.evidence-meta{font-size:11px;color:var(--muted)}
.evidence-card.compact .evidence-meta{font-size:10px}
.tag-row{display:flex;flex-wrap:wrap;gap:6px}
.tag{font-size:11px;border:1px solid var(--border);padding:2px 6px;border-radius:10px;color:var(--muted)}
.tag.strong{border-color:var(--accent);color:var(--accent)}
.evidence-supporting{display:flex;flex-wrap:wrap;gap:6px}
.evidence-term-match{border-color:var(--accent)!important;color:var(--accent)!important;background:var(--panel-soft)}
#d-citations .evidence-card{margin-top:2px}
.small-btn{background:var(--panel);border:1px solid var(--control-border);color:var(--text);font-family:'Courier New',monospace;font-size:11px;letter-spacing:.4px;padding:4px 8px;border-radius:6px;cursor:pointer}
.legacy-actions{display:none}
.viz-actions{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.progress-pill{font-size:11px;color:var(--muted);padding:5px 8px;border:1px dashed var(--border);border-radius:999px;min-width:160px;text-align:center;position:relative;overflow:hidden;transition:color .3s,border-color .3s}
.progress-pill.busy{color:var(--accent);border-color:var(--accent)}
.progress-pill.busy::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent 0%,var(--accent) 50%,transparent 100%);animation:probe-shimmer 1.5s ease-in-out infinite}
.projection-tip{font-size:11px;color:var(--muted);padding:4px 8px;border:1px solid var(--border);border-radius:999px;cursor:help}
.menu-wrap{position:relative}
.menu-pop{display:none;position:absolute;right:0;top:34px;z-index:1300;background:var(--panel);border:1px solid var(--border);border-radius:8px;min-width:210px;padding:6px}
.menu-pop.open{display:block}
.menu-item{width:100%;text-align:left;background:transparent;border:1px solid transparent;color:var(--text);font-family:'Courier New',monospace;font-size:12px;padding:8px;border-radius:6px;cursor:pointer}
.menu-item:hover{border-color:var(--accent);color:var(--accent)}
#history-drawer{position:fixed;top:56px;right:12px;z-index:1250;width:min(560px,94vw);max-height:78vh;overflow:auto;background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:12px;display:none;box-shadow:0 12px 28px #00000022}
#history-drawer.open{display:block}
.history-drawer-head{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:10px}
.history-run-card{display:flex;justify-content:space-between;align-items:flex-start;gap:10px;padding:10px;border:1px solid var(--border);border-radius:8px;background:var(--panel-alt);margin-bottom:8px}
.history-card-top{display:flex;flex-direction:column;gap:4px;flex:1;min-width:0}
.history-card-target{font-weight:600;font-size:13px;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.history-card-meta{font-size:11px;color:var(--muted)}
.history-card-discs{display:flex;flex-wrap:wrap;gap:4px;margin-top:2px}
.history-disc-chip{font-size:10px;border:1px solid;border-radius:4px;padding:1px 5px;letter-spacing:.5px}
.history-card-actions{display:flex;flex-direction:column;gap:4px;flex-shrink:0}
.history-empty{font-size:12px;color:var(--muted);padding:16px;text-align:center}
#artifact-drawer{position:fixed;top:56px;right:12px;z-index:1250;width:min(560px,94vw);max-height:78vh;overflow:auto;background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:12px;display:none;box-shadow:0 12px 28px #00000022}
#artifact-drawer.open{display:block}
.artifact-head{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:10px}
.artifact-row{display:grid;grid-template-columns:1.4fr auto;gap:10px;padding:10px;border:1px solid var(--border);border-radius:8px;background:var(--panel-alt);margin-bottom:8px}
.artifact-main{display:flex;flex-direction:column;gap:4px}
.artifact-name{font-size:13px;color:var(--text)}
.artifact-meta{font-size:11px;color:var(--muted)}
.artifact-actions{display:flex;gap:6px;flex-wrap:wrap;justify-content:flex-end}
.badge{font-size:10px;padding:2px 6px;border-radius:999px;border:1px solid var(--border);color:var(--muted)}
.badge.ready{border-color:#16a34a;color:#16a34a}
.badge.stale{border-color:#d97706;color:#d97706}
.badge.none{border-color:#6b7280;color:#6b7280}
.artifact-modal-body{max-height:60vh;overflow:auto}
.artifact-html{font-size:13px;line-height:1.6}
.matrix-wrap{overflow:auto;border:1px solid var(--border);border-radius:6px;background:var(--panel-alt)}
.matrix-table{width:100%;border-collapse:collapse;font-size:11px}
.matrix-table th,.matrix-table td{border:1px solid var(--border);padding:4px 6px;text-align:center}
.matrix-table th{background:var(--panel-soft);color:var(--muted);position:sticky;top:0}
.matrix-note{font-size:11px;color:var(--muted);line-height:1.5}
#embedding-diagnostics{display:flex;flex-direction:column;gap:8px}
#wa-hotspot-audit{display:flex;flex-direction:column;gap:8px}
#disc-sim-matrix:empty{display:none}
.filter-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.filter-grid input,.filter-grid select{font-size:12px;padding:8px 10px}
#node-filter-results{display:flex;flex-direction:column;gap:6px;max-height:180px;overflow:auto}
.node-hit{font-size:12px;background:var(--panel-alt);border:1px solid var(--border);border-radius:6px;padding:6px 8px;cursor:pointer}
.node-hit:hover{border-color:var(--accent);color:var(--accent)}
.node-hit-meta{font-size:11px;color:var(--muted);margin-top:2px}
.ca-card{display:none;flex-direction:column;gap:8px;border:1px solid var(--border);border-radius:6px;background:var(--panel-alt);padding:10px}
.ca-card img{width:100%;border:1px solid var(--border);border-radius:4px;background:var(--panel)}
.ca-meta{font-size:11px;color:var(--muted);line-height:1.45}
.ca-title{font-size:12px;color:var(--accent);letter-spacing:.4px}
.ca-derivation{font-size:11px;color:var(--muted);line-height:1.45;white-space:pre-wrap;padding-top:6px}
.ca-trajectory-wrap{border:1px solid var(--border);border-radius:4px;background:var(--panel);padding:4px}
.ca-trajectory-wrap canvas{display:block;width:100%;height:auto}
@media (max-width:900px){#viz-body{flex-direction:column}}
@media (max-width:700px){.api-row{grid-template-columns:1fr}.prefs-row{grid-template-columns:1fr}.prefs-row-wide{grid-template-columns:1fr}.mini-grid{grid-template-columns:1fr}.lens-gen-row{grid-template-columns:1fr}.disc-grid{grid-template-columns:1fr}.prompt-workbench{grid-template-columns:1fr}.prompt-preview-controls{grid-template-columns:1fr}.controls-pane{max-height:none}.workbench-sticky-nav{position:static}.run-action-strip{position:static;background:none;border-top:none;padding-top:0}#workbench-resizer{display:none}}

/* --- Progressive Disclosure & Landing Page --- */
/* Landing state */
#setup-landing{display:none}
#setup-workbench-area{display:none}
#setup.mode-landing #setup-landing{display:block}
#setup:not(.mode-landing) #setup-workbench-area{display:block}
/* Mode cards */
.mode-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.mode-card{border:1px solid var(--border);border-radius:10px;background:var(--panel);padding:24px 20px;display:flex;flex-direction:column;gap:14px;transition:border-color .2s,box-shadow .2s}
.mode-card:hover{border-color:var(--accent);box-shadow:0 0 0 2px #60a5fa22}
.mode-card-title{font-size:14px;letter-spacing:1px;color:var(--accent)}
.mode-card-desc{font-size:13px;color:var(--muted);line-height:1.6;flex:1}
.mode-card .launch-btn{align-self:flex-start;font-size:13px;padding:10px 22px}
@media(max-width:700px){.mode-cards{grid-template-columns:1fr}}
.example-run-card{grid-column:1 / -1;flex-direction:row;align-items:center;gap:20px;border-style:dashed}
.example-run-card .mode-card-title{white-space:nowrap}
.example-run-card .mode-card-desc{flex:1;margin:0}
.example-run-row{display:flex;gap:8px;align-items:center;flex-shrink:0}
.example-run-row select{font-size:13px;padding:6px 8px;border:1px solid var(--border);border-radius:6px;background:var(--input-bg,var(--panel));color:var(--text);min-width:220px}
.example-run-row select:focus{outline:none;border-color:var(--accent)}
@media(max-width:700px){.example-run-card{flex-direction:column;align-items:flex-start}.example-run-row{width:100%}.example-run-row select{flex:1}}
/* Mode bar (shown inside workbench area) */
#setup-mode-bar{display:flex;gap:8px;align-items:center;padding:4px 0;border-bottom:1px solid var(--border)}
#setup-mode-bar .mini-btn.mode-active{border-color:var(--accent);color:var(--accent);background:var(--panel-soft)}
/* Simple mode: hide advanced content and sources */
#setup.simple-mode .workflow-card{display:none}
#setup.simple-mode .note{display:none}
#setup.simple-mode>.field-group>label{display:none}
#generation-workbench.simple-mode{grid-template-columns:1fr}
#generation-workbench.simple-mode>.prompt-pane:not(#workbench-controls-pane),
#generation-workbench.simple-mode>#workbench-resizer{display:none}
#generation-workbench.simple-mode #workbench-section-sources,
#generation-workbench.simple-mode #workbench-section-lenses,
#generation-workbench.simple-mode #workbench-section-model,
#generation-workbench.simple-mode #workbench-section-grounding,
#generation-workbench.simple-mode #workbench-section-advanced,
#generation-workbench.simple-mode .workbench-sticky-nav,
#generation-workbench.simple-mode .workbench-control-stack>.tiny-note{display:none}
#generation-workbench.simple-mode .controls-pane{max-height:none}
/* Sources mode: show only sources + focus + readiness */
#generation-workbench.sources-mode{grid-template-columns:1fr}
#generation-workbench.sources-mode>.prompt-pane:not(#workbench-controls-pane),
#generation-workbench.sources-mode>#workbench-resizer{display:none}
#generation-workbench.sources-mode #focus-concept-anchor,
#generation-workbench.sources-mode #workbench-section-lenses,
#generation-workbench.sources-mode #workbench-section-model,
#generation-workbench.sources-mode #workbench-section-grounding,
#generation-workbench.sources-mode #workbench-section-advanced,
#generation-workbench.sources-mode .workbench-sticky-nav,
#generation-workbench.sources-mode .workbench-control-stack>.tiny-note{display:none}
#generation-workbench.sources-mode .controls-pane{max-height:none}
/* Advanced mode: prompt pane hidden until toggled */
#generation-workbench.prompt-pane-hidden>.prompt-pane:not(#workbench-controls-pane),
#generation-workbench.prompt-pane-hidden>#workbench-resizer{display:none}
#generation-workbench.prompt-pane-hidden{grid-template-columns:1fr}
/* News Lens — source columns grid */
.sources-controls-row{display:flex;align-items:flex-end;gap:10px;flex-wrap:wrap}
.source-status{font-size:12px;padding:4px 0;min-height:20px;color:var(--muted)}
.source-status.ok{color:#16a34a}
.source-status.err{color:#dc2626}
.expand-search-gate{display:flex;align-items:flex-start;gap:14px;padding:16px 20px;margin-bottom:10px;background:var(--panel-soft);border:2px solid var(--accent);border-radius:8px;font:12px/1.4 'Courier New',monospace}
.expand-gate-icon{flex-shrink:0;width:28px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:var(--accent);color:var(--accent-fg);font-weight:bold;font-size:16px}
.expand-gate-text{flex:1;min-width:0}
.expand-gate-title{font-size:12px;font-weight:bold;letter-spacing:1px;color:var(--accent);margin-bottom:4px}
.expand-gate-desc{color:var(--muted);line-height:1.5}
.expand-gate-actions{display:flex;flex-direction:column;gap:6px;flex-shrink:0}
.expand-gate-actions .mini-btn{white-space:nowrap;min-width:180px;text-align:center}
.source-columns{display:grid;gap:12px;margin-top:10px}
@media (min-width:1200px){.source-columns{grid-template-columns:repeat(5,1fr)}}
@media (min-width:900px) and (max-width:1199px){.source-columns{grid-template-columns:repeat(3,1fr)}}
@media (min-width:600px) and (max-width:899px){.source-columns{grid-template-columns:repeat(2,1fr)}}
@media (max-width:599px){.source-columns{grid-template-columns:1fr}}
.source-column{padding:10px;border:1px solid var(--border);border-radius:8px;background:var(--panel-alt);display:flex;flex-direction:column;gap:8px}
.source-column-header{display:flex;align-items:center;gap:8px;margin-bottom:0}
.source-column-label{font-size:11px;letter-spacing:1px;font-weight:600;color:var(--text)}
/* Expand coverage details checkbox row */
.expand-coverage-row{display:flex;align-items:center;gap:8px;margin-top:6px;font-size:11px;letter-spacing:.5px;color:var(--muted);cursor:pointer;user-select:none}
.expand-coverage-row input[type="checkbox"]{accent-color:var(--accent);cursor:pointer}
/* Select top N stepper row */
.source-col-top-n{display:flex;align-items:center;gap:6px;margin-bottom:2px;font-size:11px;color:var(--muted)}
.source-col-top-n input[type="number"]{width:42px;font-size:11px;padding:2px 4px;border:1px solid var(--border);border-radius:4px;background:var(--panel);color:var(--text);font-family:'Courier New',monospace;text-align:center}
.source-col-top-n input[type="number"]:focus{border-color:var(--accent);outline:none}
/* Click-to-select visual feedback (no checkbox) */
.source-pick-card .card-select-row{gap:0}
.source-pick-card.selected{border-color:var(--accent);border-left:3px solid var(--accent);box-shadow:0 0 0 2px #60a5fa22;background:var(--panel-soft)}
.source-col-edit-btn{font-size:11px;color:var(--muted);background:none;border:none;cursor:pointer;padding:1px 4px;border-radius:4px;line-height:1}
.source-col-edit-btn:hover{color:var(--text);background:var(--panel-soft)}
.no-stories{font-size:12px;color:var(--muted);padding:12px 10px;text-align:center;border:1px dashed var(--border);border-radius:8px}
.no-stories-warn{font-size:12px;padding:10px 12px;border:1px solid #f59e0b44;border-radius:8px;background:#f59e0b11;color:var(--text);line-height:1.5}
.source-pick-card{cursor:pointer;transition:border-color .15s,box-shadow .15s;user-select:none}
.source-pick-card:hover{border-color:var(--border)}
.source-pick-card.selected .evidence-title{color:var(--accent)}
.source-use-row{display:flex;flex-direction:column;gap:8px;margin-top:10px}
.source-selection-note{font-size:12px;color:var(--muted);text-align:center}
.mini-btn.accent{background:var(--accent);color:var(--accent-fg);border-color:var(--accent)}
.mini-btn.accent:hover{opacity:.88}
.mini-btn.accent:disabled{cursor:default;opacity:1}
/* RUN ANALYSIS button in sources panel */
#use-sources-btn{width:100%;padding:14px 20px;font-size:13px;letter-spacing:1.5px;border-radius:8px;position:relative;overflow:hidden}
/* ── Dashboard panel (Lens mode text-artifact-first) ── */
#dashboard-panel{flex:1;min-height:0;display:flex;flex-direction:column;overflow-y:auto;padding:24px;gap:16px}
#dashboard-topbar{display:flex;justify-content:space-between;align-items:center;padding:0 0 16px;border-bottom:1px solid var(--border)}
#dashboard-topbar-left{display:flex;align-items:baseline;gap:12px}
#dashboard-topic-label{font-size:13px;letter-spacing:1px;color:var(--muted)}
#dashboard-topbar-actions{display:flex;gap:8px}
#dashboard-artifact-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
@media(max-width:768px){#dashboard-artifact-grid{grid-template-columns:1fr}}
.dashboard-card{border:1px solid var(--border);border-radius:8px;background:var(--panel-alt);padding:14px;display:flex;flex-direction:column;gap:8px}
.dashboard-card-hero{min-height:120px}
.dashboard-card-header{display:flex;justify-content:space-between;align-items:center}
.dashboard-card-name{font-size:12px;letter-spacing:1px;font-weight:600;color:var(--text)}
.dashboard-card-badge{font-size:10px;padding:2px 8px;border-radius:999px;letter-spacing:.5px}
.dashboard-card-badge.ready{background:#16a34a22;color:#16a34a}
.dashboard-card-badge.generating{background:var(--accent);color:var(--accent-fg);animation:probe-shimmer 1.5s ease-in-out infinite}
.dashboard-card-badge.pending{background:var(--panel-soft);color:var(--muted)}
.dashboard-card-preview{font-size:12px;color:var(--muted);line-height:1.5;max-height:80px;overflow:hidden}
.dashboard-card-actions{display:flex;gap:6px;margin-top:auto}
.dashboard-card-actions .mini-btn{font-size:10px;padding:4px 10px}
#dashboard-artifact-progress{margin-bottom:4px}
#dashboard-artifact-progress-label{font-size:11px;color:var(--muted);letter-spacing:.5px;margin-bottom:4px}
.dashboard-progress-bar{width:100%;height:6px;background:var(--border);border-radius:3px;overflow:hidden}
.dashboard-progress-bar-fill{height:100%;background:var(--accent);border-radius:3px;width:0%;transition:width .3s ease}
.sources-loading .sources-controls-row,.sources-loading .source-columns{pointer-events:none;opacity:.45;transition:opacity .15s}
.source-edit-popover{position:absolute;z-index:300;background:var(--panel);border:1px solid var(--border);border-radius:8px;padding:12px;min-width:260px;box-shadow:0 4px 16px #0003}
.source-edit-popover .source-edit-title{font-size:11px;letter-spacing:1px;margin-bottom:8px;color:var(--muted)}
.source-edit-popover .source-feed-row{display:flex;align-items:center;gap:6px;margin-bottom:4px;font-size:12px;word-break:break-all}
.source-edit-popover .source-feed-row button{font-size:11px;padding:1px 5px;flex-shrink:0}
.source-edit-add-row{display:flex;gap:6px;margin-top:8px}
.source-edit-add-row input{flex:1;font-size:12px;padding:4px 8px}
.custom-lens-editor{margin-top:10px;padding:10px;border:1px solid var(--border);border-radius:8px;background:var(--panel-soft)}
.custom-col-row{display:flex;gap:8px;flex-wrap:wrap;align-items:flex-start;margin-bottom:10px;padding:8px;border:1px solid var(--border);border-radius:6px;background:var(--panel)}
.custom-col-row input[type=text]{font-size:12px;padding:4px 8px;width:120px}
.custom-col-row textarea{font-size:12px;padding:4px 8px;min-height:60px;resize:vertical;flex:1;min-width:180px}
/* Card selection row (no checkbox — click to select) */
.card-select-row{display:flex;gap:8px;align-items:flex-start}
/* Card expand / snippet */
.source-card-snippet{font-size:11px;color:var(--muted);line-height:1.5;margin-top:3px}
.source-pick-card.card-expanded{border-style:dashed}
.mini-link-btn{background:none;border:none;cursor:pointer;font-size:11px;color:var(--accent);padding:0;text-decoration:underline;text-underline-offset:2px}
.mini-link-btn:hover{opacity:.75}
/* Low-relevance collapsible */
.low-rel-toggle{margin:6px 0 2px;display:block;color:var(--muted)}
.low-rel-section{border-top:1px dashed var(--border);margin-top:4px;padding-top:4px;display:flex;flex-direction:column;gap:8px}
/* Source outlet indicators (favicon circles in column headers) */
.source-outlets{display:flex;align-items:center;gap:0;margin-left:auto;flex-shrink:0}
.source-outlet-icon{width:20px;height:20px;border-radius:50%;border:1.5px solid var(--border);background:var(--panel-soft);object-fit:cover;margin-left:-4px;cursor:pointer;transition:transform .15s,border-color .15s,z-index 0s}
.source-outlet-icon:first-child{margin-left:0}
.source-outlet-icon:hover{transform:scale(1.3);border-color:var(--accent);z-index:2;position:relative}
.source-outlet-overflow{width:20px;height:20px;border-radius:50%;border:1.5px solid var(--border);background:var(--panel-alt);margin-left:-4px;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:600;color:var(--muted);cursor:pointer;transition:transform .15s}
.source-outlet-overflow:hover{transform:scale(1.3);border-color:var(--accent)}
.source-outlet-detail{display:none;padding:8px 10px;margin-top:4px;border:1px solid var(--border);border-radius:6px;background:var(--panel-soft);font-size:11px;line-height:1.6}
.source-outlet-detail.open{display:block}
.source-outlet-detail-row{display:flex;align-items:center;gap:6px;color:var(--muted)}
.source-outlet-detail-row img{width:14px;height:14px;border-radius:50%;flex-shrink:0}
.source-outlet-detail-count{margin-left:auto;font-size:10px;color:var(--text);font-weight:600}
/* Article preview modal */
#source-article-modal{display:none}
#source-article-modal.open{display:flex}
/* Seed URL input row */
.seed-url-row{margin-bottom:8px}
.seed-url-row input[type="url"]{width:100%;box-sizing:border-box;font-size:13px;padding:6px 10px;border:1px solid var(--border);border-radius:6px;background:var(--input-bg,var(--panel));color:var(--text)}
.seed-url-row input[type="url"]:focus{outline:none;border-color:var(--accent)}
.seed-url-row input[type="url"]::placeholder{color:var(--muted)}
/* Anchor card */
.seed-anchor-row{margin-bottom:12px}
.anchor-card{border:1px solid var(--accent);border-radius:8px;padding:10px 14px;background:var(--panel-soft,var(--panel));font-size:12px}
.anchor-card-meta-row{display:flex;align-items:center;gap:8px;margin-bottom:4px;flex-wrap:wrap}
.anchor-card-badge{font-size:10px;font-weight:700;letter-spacing:1px;background:var(--accent);color:var(--accent-fg);border-radius:4px;padding:1px 6px}
.anchor-card-date{color:var(--muted);font-size:11px}
.anchor-card-link{color:var(--accent);font-size:11px;text-decoration:none}
.anchor-card-link:hover{text-decoration:underline}
.anchor-card-title{font-weight:600;margin-bottom:4px;color:var(--text)}
.anchor-card-entities{color:var(--muted);margin-bottom:2px}
.anchor-card-topic{color:var(--accent);margin-bottom:4px}
.anchor-card-note{color:var(--muted);font-style:italic;font-size:11px}

/* ── Shutter transition ── */
#plot-vignette{transition:opacity .6s ease}
#plot-vignette.shutter-active{opacity:1!important;background:var(--bg);pointer-events:auto;z-index:900}
.shutter-msg{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font:bold 14px/1 'Courier New',monospace;letter-spacing:2px;text-transform:lowercase;color:var(--muted);opacity:.7}

/* ── Gallery (quipu/circuit) ── */
.gallery-svg{position:absolute;inset:0;width:100%;height:100%;z-index:10}
.gallery-cord{stroke:var(--muted);stroke-width:2;fill:none;opacity:.35}
.gallery-branch{stroke:var(--muted);stroke-width:1.5;fill:none;stroke-dasharray:4 2;opacity:.3}
.gallery-edge{stroke-width:1.5;fill:none;stroke-linecap:round;stroke-linejoin:round}
.gallery-node{cursor:pointer;transition:filter .15s}
.gallery-node:hover{filter:brightness(1.3)}
.gallery-node.focused{filter:drop-shadow(0 0 6px var(--accent))}
.gallery-label{font:11px/1.3 'Courier New',monospace;fill:var(--text)}
.gallery-edge-label{font:9px/1 'Courier New',monospace;opacity:.7;pointer-events:none}
.gallery-strand-info{position:absolute;top:12px;left:50%;transform:translateX(-50%);font:bold 12px 'Courier New',monospace;color:var(--muted);letter-spacing:1px;text-transform:uppercase;z-index:20;pointer-events:none}
.gallery-info-panel{position:fixed;bottom:16px;right:16px;z-index:460;background:var(--panel);border:1px solid var(--border);border-radius:8px;padding:10px 14px;display:flex;flex-direction:column;gap:8px;pointer-events:auto;box-shadow:0 4px 16px #00000033}
.gallery-legend{display:flex;flex-direction:column;gap:4px}
.gallery-legend-row{display:flex;align-items:center;gap:8px}
.gallery-legend-line{display:inline-block;width:20px;height:2px;flex-shrink:0}
.gallery-legend-label{font:10px/1 'Courier New',monospace;letter-spacing:.5px}
.gallery-nav-keys{font:11px/1 'Courier New',monospace;color:var(--muted);opacity:.7;border-top:1px solid var(--border);padding-top:8px}
body.gallery-active #plot-wrap{flex:1;min-height:0;height:100%}
body.gallery-active #plot{display:none!important}
body.gallery-active .panel-hint{display:none}
