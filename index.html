<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Parallax</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.27.0/plotly.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<link rel="stylesheet" href="css/styles.css"/>
</head>
<body>
<div id="main-tabs">
  <div class="tabs-left" role="tablist" aria-label="Workspace Views">
    <button class="tab-btn active" id="tab-generator-btn" type="button" role="tab" aria-selected="true" aria-controls="setup" tabindex="0">SETUP</button>
    <button class="tab-btn" id="tab-plot-btn" type="button" role="tab" aria-selected="false" aria-controls="plot-panel" tabindex="-1">PLOT VIEW</button>
  </div>
  <div class="tabs-right">
    <button class="mini-btn" id="history-btn" type="button">HISTORY</button>
    <button class="mini-btn" id="import-run-btn" type="button">IMPORT RUN</button>
    <button class="mini-btn" id="export-run-btn" type="button">EXPORT RUN</button>
    <select id="theme-select-global">
      <option value="light">Light Theme</option>
      <option value="dark">Dark Theme</option>
      <option value="contrast">High Contrast</option>
    </select>
    <input type="file" id="run-file-input" accept="application/json,.json" style="display:none"/>
  </div>
</div>
<div id="setup" class="mode-landing" role="tabpanel" aria-labelledby="tab-generator-btn" tabindex="-1">
  <div>
    <div class="logo">PARALLAX</div>
    <h1>See every angle at once.</h1>
    <div class="sub">bring your own key | open-model probes | embedding-native topology</div>
  </div>
  <div id="setup-landing">
    <div class="mode-cards">
      <div class="mode-card" id="mode-card-simple">
        <div class="mode-card-title">PARALLAX EXPLORE</div>
        <div class="mode-card-desc">Enter a concept and explore it from multiple angles. The tool chooses lenses and settings automatically.</div>
        <button class="launch-btn" data-mode="simple" type="button">START</button>
      </div>
      <div class="mode-card" id="mode-card-sources">
        <div class="mode-card-title">PARALLAX LENS</div>
        <div class="mode-card-desc">Paste a news article URL and see how it's covered across perspectives. Pick sources from each angle — the analysis runs on what they actually say.</div>
        <button class="launch-btn" data-mode="sources" type="button">START</button>
      </div>
      <div class="mode-card" id="mode-card-advanced">
        <div class="mode-card-title">ADVANCED</div>
        <div class="mode-card-desc">Full workbench with custom probe lenses, model selection, prompt overrides, and CA diagnostics.</div>
        <button class="launch-btn" data-mode="advanced" type="button">START</button>
      </div>
    </div>
    <div class="mode-card example-run-card" id="mode-card-example">
      <div class="mode-card-title">LOAD AN EXAMPLE</div>
      <div class="mode-card-desc">No API key? Browse a completed run to explore the interface and see what the tool produces.</div>
      <div class="example-run-row">
        <select id="example-run-select"></select>
        <button class="launch-btn" id="load-example-btn" type="button">LOAD</button>
      </div>
    </div>
  </div>
  <div id="setup-workbench-area">
  <div id="setup-mode-bar">
    <button class="mini-btn" id="setup-mode-simple-btn" type="button">EXPLORE</button>
    <button class="mini-btn" id="setup-mode-sources-btn" type="button">LENS</button>
    <button class="mini-btn" id="setup-mode-advanced-btn" type="button">ADVANCED</button>
    <button class="mini-btn" id="setup-prompt-pane-btn" type="button" style="margin-left:auto;display:none">SHOW PROMPT EDITOR</button>
  </div>
  <div class="workflow-card">
    <div class="workflow-title">SETUP WORKFLOW</div>
    <ol class="workflow-list">
      <li><b>Focus Concept</b>: set the core topic you want mapped.</li>
      <li><b>Probe Lenses</b>: edit/customize lenses, then optionally auto-generate alternatives.</li>
      <li><b>Model + Runtime</b>: choose API mode, research model, embedding model, and quality profile.</li>
      <li><b>Grounding + Source Policy</b>: tune web/Wolfram behavior, source policy, and acceptance thresholds.</li>
      <li><b>Prompt Editor</b>: choose prompt kind, inspect defaults, edit templates, and click <b>APPLY OVERRIDE</b>.</li>
      <li><b>Advanced Experiments</b> (optional): CA probe, red-team critique, and replication settings.</li>
      <li><b>Run + Readiness Summary</b>: resolve blocking checks, then run.</li>
      <li><b>Long-panel ergonomics</b>: use section shortcuts, sticky readiness strip, and horizontal resizer for comfort.</li>
    </ol>
    <div class="workflow-note">Relevance and grounding are separate axes. WA status affects grounding display and diagnostics, not term relevance.</div>
  </div>
  <div class="field-group">
    <label>WORKBENCH</label>
    <div class="prompt-workbench" id="generation-workbench">
      <div class="prompt-pane">
        <div class="prompt-pane-title">5. PROMPT EDITOR (KIND -> EDIT -> APPLY)</div>
        <div class="prompt-preview-controls">
          <div class="field-group compact-field">
            <label for="prompt-preview-kind-select">Prompt kind</label>
            <select id="prompt-preview-kind-select" title="Preview prompt type">
              <option value="probe_user">Probe user prompt</option>
              <option value="probe_system">Probe system prompt</option>
              <option value="synthesis">Synthesis prompt</option>
              <option value="lens_generation">Lens-generation prompt</option>
              <option value="artifact_deep_report">Artifact prompt: Deep report</option>
              <option value="artifact_claims">Artifact prompt: Claims</option>
              <option value="artifact_outline">Artifact prompt: Outline</option>
              <option value="artifact_red_team">Artifact prompt: Red-team</option>
              <option value="artifact_replication">Artifact prompt: Replication</option>
              <option value="artifact_markdown">Artifact prompt: Markdown</option>
            </select>
          </div>
          <div class="field-group compact-field" id="prompt-preview-disc-wrap">
            <label for="prompt-preview-disc-select">Probe lens (for probe user prompt)</label>
            <select id="prompt-preview-disc-select" title="Preview discipline"></select>
          </div>
          <button class="small-btn" id="prompt-preview-refresh-btn" type="button">REFRESH</button>
        </div>
        <div class="prompt-kind-help" id="prompt-preview-kind-help" aria-live="polite"></div>
        <textarea id="prompt-preview-params" class="prompt-params" readonly aria-label="Prompt parameter narrative"></textarea>
        <input type="text" id="prompt-preview-status" class="prompt-status" readonly aria-live="polite" value="Using default prompt template"/>
        <div class="prompt-override-summary" id="prompt-override-summary" aria-live="polite"></div>
        <label for="prompt-preview-system">SYSTEM PROMPT TEMPLATE (editable)</label>
        <textarea id="prompt-preview-system" class="prompt-editable" spellcheck="false"></textarea>
        <label for="prompt-preview-user">USER PROMPT TEMPLATE (editable)</label>
        <textarea id="prompt-preview-user" class="prompt-editable" spellcheck="false"></textarea>
        <div class="probe-actions">
          <button class="mini-btn" id="prompt-preview-apply-btn" type="button">APPLY OVERRIDE</button>
          <button class="mini-btn" id="prompt-preview-reset-btn" type="button">RESET TO DEFAULT</button>
          <button class="mini-btn" id="prompt-preview-discard-btn" type="button">DISCARD EDITS</button>
        </div>
        <div class="tiny-note">Defaults are always visible. Edits affect runtime only after <b>APPLY OVERRIDE</b>.</div>
      </div>
      <div id="workbench-resizer" role="separator" aria-orientation="vertical" aria-label="Resize generation workbench panels" tabindex="0"></div>
      <div class="prompt-pane controls-pane" id="workbench-controls-pane">
        <div class="prompt-pane-title">RUN CONTROLS + READINESS</div>
        <div class="workbench-sticky-nav" aria-label="Generation section shortcuts">
          <button class="mini-btn" type="button" data-workbench-jump="focus-concept-anchor">1. FOCUS</button>
          <button class="mini-btn" type="button" data-workbench-jump="workbench-section-lenses">2. LENSES</button>
          <button class="mini-btn" type="button" data-workbench-jump="workbench-section-model">3. MODEL</button>
          <button class="mini-btn" type="button" data-workbench-jump="workbench-section-readiness">4. READINESS</button>
        </div>
        <div class="workbench-control-stack">
          <fieldset class="workbench-section" id="focus-concept-anchor">
            <legend class="workbench-section-title">Focus Concept</legend>
            <div class="field-group">
              <label for="target-input">FOCUS CONCEPT</label>
              <input type="text" id="target-input" placeholder="e.g. consciousness, money, entropy, love, justice..." value=""/>
            </div>
          </fieldset>
          <fieldset class="workbench-section" id="workbench-section-sources">
            <legend class="workbench-section-title">Source Coverage</legend>
            <div class="seed-url-row">
              <div class="field-group" style="flex:1">
                <label for="seed-url-input">Article URL to explore</label>
                <input type="url" id="seed-url-input" placeholder="Paste any article URL — we'll find how it's covered across perspectives" spellcheck="false" autocomplete="off">
              </div>
            </div>
            <div class="sources-controls-row">
              <div class="field-group" style="min-width:140px">
                <label for="lens-select">Perspective lens</label>
                <select id="lens-select">
                  <option value="political">Political Spectrum</option>
                  <option value="geographic">Geographic</option>
                  <option value="domain">Domain</option>
                  <option value="custom">Custom</option>
                </select>
              </div>
              <button class="mini-btn" id="find-stories-btn" type="button">FIND STORIES</button>
              <button class="mini-btn" id="clear-sources-btn" type="button">CLEAR</button>
            </div>
            <div class="source-status" id="source-status" aria-live="polite"></div>
            <div class="seed-anchor-row" id="seed-anchor-row" style="display:none"></div>
            <div class="source-columns" id="source-columns" style="display:none"></div>
            <div class="source-use-row" id="source-use-row" style="display:none">
              <button class="mini-btn accent" id="use-sources-btn" type="button">USE SELECTED SOURCES</button>
              <span class="source-selection-note" id="source-selection-note"></span>
            </div>
            <div class="custom-lens-editor" id="custom-lens-editor" style="display:none">
              <div class="tiny-note">Define your own columns. Each needs a label and at least one RSS URL (one per line).</div>
              <div id="custom-columns-list"></div>
              <button class="mini-btn" id="add-custom-column-btn" type="button">+ ADD COLUMN</button>
            </div>
          </fieldset>
          <fieldset class="workbench-section" id="workbench-section-lenses">
            <legend class="workbench-section-title">Probe Lenses</legend>
            <div class="field-group">
              <label>PROBE LENSES (CLICK TO CUSTOMIZE)</label>
              <div class="disc-grid" id="disc-inputs"></div>
              <div class="probe-actions">
                <button class="mini-btn" id="add-probe-btn" type="button">ADD LENS</button>
              </div>
            </div>
            <div class="field-group">
              <label for="lens-count-input">AUTO-GENERATE LENSES</label>
              <div class="lens-gen-row">
                <input type="number" id="lens-count-input" min="2" max="12" value="7"/>
                <button class="mini-btn" id="gen-lenses-btn" type="button">GENERATE</button>
              </div>
              <div class="tiny-note">Creates mutually distinct lenses while staying relevant to your focus concept.</div>
            </div>
          </fieldset>
          <fieldset class="workbench-section" id="workbench-section-model">
            <legend class="workbench-section-title">Model + Runtime</legend>
            <div class="api-row">
              <div class="field-group compact-field">
                <label for="research-model-input">RESEARCH MODEL</label>
                <select id="research-model-input" title="Reasoning model">
                  <option value="deepseek/deepseek-r1" selected>deepseek/deepseek-r1</option>
                  <option value="qwen/qwen-2.5-72b-instruct">qwen/qwen-2.5-72b-instruct</option>
                  <option value="openai/gpt-oss-120b">openai/gpt-oss-120b</option>
                  <option value="qwen/qwen3-coder">qwen/qwen3-coder</option>
                  <option value="anthropic/claude-sonnet-4.6">anthropic/claude-sonnet-4.6</option>
                  <option value="google/gemini-3.1-pro-preview">google/gemini-3.1-pro-preview</option>
                  <option value="moonshotai/kimi-k2.5">moonshotai/kimi-k2.5</option>
                  <option value="z-ai/glm-5">z-ai/glm-5</option>
                </select>
              </div>
              <div class="field-group compact-field">
                <label for="embedding-model-input">EMBEDDING MODEL</label>
                <select id="embedding-model-input" title="Embedding model">
                  <option value="qwen/qwen3-embedding-8b" selected>qwen/qwen3-embedding-8b</option>
                  <option value="baai/bge-large-en-v1.5">baai/bge-large-en-v1.5</option>
                  <option value="intfloat/e5-large-v2">intfloat/e5-large-v2</option>
                  <option value="thenlper/gte-large">thenlper/gte-large</option>
                  <option value="openai/text-embedding-3-large">openai/text-embedding-3-large</option>
                  <option value="openai/text-embedding-3-small">openai/text-embedding-3-small</option>
                  <option value="google/gemini-embedding-001">google/gemini-embedding-001</option>
                  <option value="mistralai/mistral-embed-2312">mistralai/mistral-embed-2312</option>
                </select>
              </div>
            </div>
            <div class="field-group">
              <label for="quality-mode-select">QUALITY PROFILE</label>
              <select id="quality-mode-select">
                <option value="fast">Fast (speed-first)</option>
                <option value="balanced" selected>Balanced</option>
                <option value="rigor">Rigor (deeper, slower)</option>
              </select>
              <div class="tiny-note">Controls term count, synthesis depth, temperature, embedding batch size, and optional cleanup pass.</div>
            </div>
          </fieldset>
          <fieldset class="workbench-section" id="workbench-section-grounding">
            <legend class="workbench-section-title">Source Policy</legend>
            <div class="prefs-row prefs-row-single">
              <div class="toggle-wrap">
                <input type="checkbox" id="web-search-check" checked/>
                <label for="web-search-check">Enable web search grounding</label>
              </div>
            </div>
            <div class="field-group">
              <label for="source-policy-input">SOURCE POLICY</label>
              <input type="text" id="source-policy-input" placeholder="e.g. prioritize peer-reviewed + government data; allow journalism; avoid blogs"/>
            </div>
          </fieldset>
          <details class="workbench-section workbench-advanced" id="workbench-section-advanced">
            <summary class="workbench-section-title">Advanced Experiments (optional)</summary>
            <div class="workbench-advanced-body">
              <div class="prefs-row-wide">
                <div class="toggle-wrap">
                  <input type="checkbox" id="ca-probe-check"/>
                  <label for="ca-probe-check">Enable computational irreducibility diagnostic</label>
                </div>
                <div class="toggle-wrap">
                  <input type="checkbox" id="redteam-check"/>
                  <label for="redteam-check">Enable red-team critique</label>
                </div>
              </div>
              <div class="field-group compact-field" id="ca-override-group" style="display:none">
                <label>MANUAL OVERRIDE (leave blank for auto-derivation)</label>
                <div class="mini-grid">
                  <input type="number" id="ca-rule-input" min="0" max="255" placeholder="Rule (auto)" title="manual override for CA rule (0-255)"/>
                  <input type="number" id="ca-steps-input" min="16" max="240" placeholder="Steps (auto)" title="manual override for CA steps (16-240)"/>
                </div>
                <input type="number" id="ca-width-input" min="31" max="401" placeholder="Width (auto)" title="manual override for CA width (odd 31-401 preferred)"/>
                <div class="tiny-note">
                  When blank, all parameters are derived from the run's actual probe topology,
                  synthesis depth, and term count. Manual values override derivation.
                </div>
              </div>
              <div class="field-group">
                <label for="replication-models-input">REPLICATION MODELS (COMMA-SEPARATED)</label>
                <input type="text" id="replication-models-input" placeholder="replication models (comma-separated)"/>
              </div>
              <div class="mini-grid">
                <div class="field-group compact-field">
                  <label for="replication-runs-input">RUNS PER MODEL</label>
                  <input type="number" id="replication-runs-input" min="1" max="5" value="1" title="number of reruns per model"/>
                </div>
                <div class="field-group compact-field">
                  <label for="replication-strategy-select">REPLICATION STRATEGY</label>
                  <select id="replication-strategy-select" title="temperature/seed strategy">
                    <option value="fixed">Fixed params</option>
                    <option value="jitter">Temperature jitter</option>
                  </select>
                </div>
              </div>
              <div class="tiny-note">Left box is runs per model. Right selector controls fixed parameters vs temperature jitter.</div>
            </div>
          </details>
          <fieldset class="workbench-section" id="workbench-section-readiness">
            <legend class="workbench-section-title">Readiness &amp; Launch</legend>
            <div class="api-row">
              <div class="field-group compact-field">
                <label for="api-mode">API MODE</label>
                <select id="api-mode"><option value="direct">Direct (browser)</option><option value="proxy">Proxy (localhost)</option></select>
              </div>
            </div>
            <div class="api-key-row">
              <input type="password" id="api-key-input" autocomplete="off" spellcheck="false" placeholder="OpenRouter key (required in direct mode)"/>
              <button class="mini-btn" id="toggle-key-btn" type="button">SHOW</button>
              <button class="mini-btn" id="clear-key-btn" type="button">CLEAR</button>
            </div>
            <div class="tiny-note" id="api-mode-note"></div>
            <div class="run-readiness-status" id="run-readiness-status" aria-live="polite">Checking run readiness...</div>
            <ul class="readiness-list" id="run-readiness-list"></ul>
            <div class="run-action-strip">
              <button class="launch-btn" id="launch-btn" type="button">RUN</button>
            </div>
          </fieldset>
          <div class="tiny-note">Long-panel ergonomics: shortcuts are sticky at the top, readiness action strip is sticky at the bottom, and the center divider is draggable.</div>
        </div>
      </div>
    </div>
  </div>
  <div class="note">Each lens runs an independent model query. Synthesis then links overlaps, tensions, and emergent terms. Final nodes are embedded and projected into 3D where distance reflects semantic similarity. Typical run: ~10-16 API calls, depending on term count and embedding batches.</div>
  </div><!-- /#setup-workbench-area -->
</div>
<div id="plot-panel" role="tabpanel" aria-labelledby="tab-plot-btn" tabindex="-1" hidden>
<div id="progress">
  <div><div class="prog-title">ANALYSIS IN PROGRESS</div><div class="prog-target" id="prog-target-label"></div></div>
  <div class="probe-list" id="probe-list"></div>
  <div class="synth-bar" id="synth-bar">SYNTHESIS - waiting for probes...</div>
</div>
<div id="viz">
  <div id="viz-topbar">
    <div id="viz-topbar-left">PARALLAX — <span id="viz-target-label"></span></div>
    <div id="viz-topbar-right">
      <div class="viz-actions">
        <span style="font-size:12px;color:var(--muted);letter-spacing:.5px"><span id="vis-count">0</span> TERMS</span>
        <span class="projection-tip" title="Distances are suggestive; global direction/opposites are not invariant under projection.">PROJECTION NOTE</span>
        <span class="progress-pill" id="artifact-progress-text">Idle</span>
        <button class="reset-btn" id="artifacts-btn" title="Open run artifacts and their status">ARTIFACTS</button>
        <div class="menu-wrap">
          <button class="reset-btn" id="export-menu-btn" title="Open export options">EXPORT</button>
          <div class="menu-pop" id="export-menu">
            <button class="menu-item" id="export-menu-figure" type="button">Download Figure (PNG)</button>
            <button class="menu-item" id="export-menu-markdown" type="button">Download Report (MD)</button>
            <button class="menu-item" id="export-menu-bundle" type="button">Export Bundle (.zip)</button>
          </div>
        </div>
        <button class="reset-btn" id="gallery-btn" title="Enter gallery view (2D strand diagrams)">GALLERY</button>
        <button class="reset-btn" id="controls-btn" title="Toggle controls panel">CONTROLS</button>
        <button class="reset-btn" id="zen-mode-btn" type="button" aria-pressed="false" title="Hide top menu and left panel for cinematic capture">ZEN MODE</button>
        <button class="reset-btn" id="new-run-btn" title="Reset current run and start over">NEW</button>
      </div>
      <div class="legacy-actions">
        <button class="reset-btn" id="raw-list-btn">RAW NODES</button><button class="reset-btn" id="evidence-btn">EVIDENCE</button><button class="reset-btn" id="claims-btn">CLAIMS</button><button class="reset-btn" id="redteam-btn">RED TEAM</button><button class="reset-btn" id="replication-btn">REPLICATION</button><button class="reset-btn" id="outline-btn">OUTLINE</button><button class="reset-btn" id="export-md-btn">EXPORT MD</button><button class="reset-btn" id="export-fig-btn">EXPORT FIGURE</button><button class="reset-btn" id="rerun-synth-btn">RERUN SYNTH</button><button class="reset-btn" id="deep-report-btn">DEEP REPORT</button><button class="reset-btn" id="reset-btn">NEW RUN</button>
      </div>
    </div>
  </div>
  <div id="viz-body">
    <div id="plot-wrap"><div id="plot"></div></div>
  </div>
  <!-- Vignette overlay (position:fixed so it composites above the WebGL canvas) -->
  <div id="plot-vignette"><span class="shutter-msg"></span></div>
  <!-- Panel triggers -->
  <button class="panel-trigger trigger-left" id="controls-trigger" aria-label="Open controls panel"><span class="trigger-arrow">&#8250;</span></button>
  <button class="panel-trigger trigger-bottom" id="diagnostics-trigger" aria-label="Open diagnostics panel"><span class="trigger-arrow">&#8593;</span></button>
  <!-- Onboarding hint tags (dismissed on first panel open via sessionStorage) -->
  <div class="panel-hint" id="controls-hint">CONTROLS ›</div>
  <div class="panel-hint panel-hint-bottom" id="diagnostics-hint">↑ DIAGNOSTICS</div>
  <div class="panel-hint panel-hint-plot" id="plot-nav-hint">← controls &nbsp;·&nbsp; ↑ diagnostics</div>
  <!-- Controls floating panel -->
  <div class="floating-panel" id="controls-panel">
    <div class="floating-panel-header">
      <span class="floating-panel-title">CONTROLS</span>
      <button class="floating-panel-close" aria-label="Close controls">&#215;</button>
    </div>
    <div class="floating-panel-body">
      <div>
        <div class="sec-label">PROBE DISCIPLINES</div>
        <div id="disc-list"></div>
      </div>
      <div>
        <div class="sec-label">TERM CATEGORIES</div>
        <div id="type-list"></div>
      </div>
      <div>
        <div class="sec-label">NODE COLOR MODE</div>
        <div class="field-group" style="margin-top:6px">
          <select id="node-color-mode-select">
            <option value="type">Color by node type</option>
            <option value="citations">Color by citation count</option>
          </select>
        </div>
        <div class="matrix-note" id="grounding-encoding-note">Node type color mode active.</div>
      </div>
      <div id="node-filter-panel">
        <div class="sec-label">NODE SEARCH / FILTER</div>
        <input type="text" id="node-search-input" placeholder="Search node label (fuzzy)" aria-label="Node search"/>
        <div class="filter-grid" style="margin-top:6px">
          <select id="node-type-filter" aria-label="Filter by node type">
            <option value="all">Type: all</option>
            <option value="unique">Type: unique</option>
            <option value="convergent">Type: convergent</option>
            <option value="contradictory">Type: contradictory</option>
            <option value="emergent">Type: emergent</option>
          </select>
          <input type="number" id="node-min-probe-filter" min="0" value="0" placeholder="Min probe count" aria-label="Minimum probe count"/>
          <input type="number" id="node-min-citation-filter" min="0" value="0" placeholder="Min citation count" aria-label="Minimum citation count"/>
          <select id="node-sort-select" aria-label="Sort nodes">
            <option value="probe_coverage">Sort: probe coverage</option>
            <option value="citation_count">Sort: citation count</option>
            <option value="alphabetical">Sort: alphabetical</option>
          </select>
          <button class="small-btn" id="node-filter-clear-btn" type="button">CLEAR</button>
        </div>
        <div class="matrix-note" id="node-filter-summary" style="margin-top:6px">No nodes loaded.</div>
        <div id="node-filter-results"></div>
      </div>
    </div>
  </div>
  <!-- Term detail floating panel -->
  <div class="floating-panel" id="term-detail-panel">
    <div class="floating-panel-header">
      <span class="floating-panel-title">SELECTED</span>
      <button class="floating-panel-close" aria-label="Close term detail">&#215;</button>
    </div>
    <div class="floating-panel-body">
      <div id="detail">
        <h3 id="d-label"></h3>
        <div class="detail-type" id="d-type"></div>
        <div class="detail-desc" id="d-desc"></div>
        <div class="dtags" id="d-slices"></div>
        <div class="sec-label" style="margin-top:10px">EVIDENCE</div>
        <div class="card-list" id="d-citations"></div>
      </div>
    </div>
  </div>
  <!-- Diagnostics floating panel -->
  <div class="floating-panel" id="diagnostics-panel">
    <div class="floating-panel-header">
      <span class="floating-panel-title">DIAGNOSTICS</span>
      <button class="floating-panel-close" aria-label="Close diagnostics">&#215;</button>
    </div>
    <div class="floating-panel-body">
      <div id="embedding-diagnostics">
        <div class="sec-label">PROJECTION CHECKS</div>
        <div class="matrix-note" id="disc-sim-status">No embedding diagnostics yet.</div>
        <div class="matrix-note" id="projection-stability"></div>
        <div class="matrix-wrap" id="disc-sim-matrix"></div>
      </div>
      <div id="wa-hotspot-audit">
        <div class="sec-label">GENERIC INTERPRETATION HOTSPOT AUDIT</div>
        <div class="matrix-note" id="wa-hotspot-status">No Wolfram interpretation hotspot diagnostics yet.</div>
        <div class="matrix-wrap" id="wa-hotspot-matrix"></div>
      </div>
      <div class="ca-card" id="ca-panel">
        <div class="sec-label">COMPUTATIONAL IRREDUCIBILITY DIAGNOSTIC</div>
        <div class="ca-title" id="ca-title"></div>
        <div class="ca-meta" id="ca-meta"></div>
        <details>
          <summary class="ca-meta" style="cursor:pointer">DERIVATION DETAILS</summary>
          <div class="ca-derivation" id="ca-derivation"></div>
        </details>
        <img id="ca-image" alt="Cellular automaton evolution"/>
        <div class="ca-trajectory-wrap" id="ca-trajectory-wrap">
          <canvas id="ca-trajectory-canvas" width="280" height="90"></canvas>
        </div>
        <div class="ca-meta" id="ca-commentary"></div>
      </div>
      <div id="stats"><div class="sec-label">CORPUS</div><div id="stat-rows"></div></div>
    </div>
  </div>
</div>
</div>
<div id="toast"></div>
<div id="history-drawer">
  <div class="history-drawer-head">
    <div style="font-size:13px;letter-spacing:.5px;color:var(--accent)">RUN HISTORY</div>
    <button class="small-btn" id="history-drawer-close" type="button">CLOSE</button>
  </div>
  <div id="history-list"></div>
</div>
<div id="artifact-drawer">
  <div class="artifact-head">
    <div style="font-size:13px;letter-spacing:.5px;color:var(--accent)">RUN ARTIFACTS</div>
    <button class="small-btn" id="artifact-drawer-close" type="button">CLOSE</button>
  </div>
  <div id="artifact-list"></div>
  <div style="display:flex;justify-content:flex-end;margin-top:8px">
    <button class="small-btn" id="artifact-rerun-synth-btn" type="button" title="Re-run synthesis and mark downstream artifacts stale">RERUN SYNTHESIS</button>
  </div>
</div>
<div class="modal" id="artifact-modal">
  <div class="modal-card">
    <div class="modal-top">
      <div>
        <div class="modal-title" id="artifact-modal-title">ARTIFACT</div>
        <div class="evidence-meta" id="artifact-modal-meta"></div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="reset-btn" id="artifact-copy-btn" type="button">COPY</button>
        <button class="reset-btn" id="artifact-download-btn" type="button">DOWNLOAD</button>
        <button class="reset-btn" id="artifact-regenerate-btn" type="button">REGENERATE</button>
        <button class="reset-btn" id="artifact-close-btn" type="button">CLOSE</button>
      </div>
    </div>
    <div class="artifact-modal-body">
      <div class="mono-block" id="artifact-modal-content"></div>
    </div>
  </div>
</div>
<div class="modal" id="raw-modal">
  <div class="modal-card">
    <div class="modal-top">
      <div class="modal-title">RAW NODE LIST</div>
      <button class="reset-btn" id="raw-close-btn" type="button">CLOSE</button>
    </div>
    <div class="mono-block" id="raw-modal-content"></div>
  </div>
</div>
<div class="modal" id="report-modal">
  <div class="modal-card">
    <div class="modal-top">
      <div class="modal-title">DEEP RESEARCH REPORT</div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="reset-btn" id="report-copy-btn" type="button">COPY</button>
        <button class="reset-btn" id="report-close-btn" type="button">CLOSE</button>
      </div>
    </div>
    <div class="mono-block" id="report-modal-content"></div>
  </div>
</div>
<div class="modal" id="source-article-modal">
  <div class="modal-card">
    <div class="modal-top">
      <div class="modal-title" id="source-article-modal-title">ARTICLE</div>
      <button class="reset-btn" id="source-article-close-btn" type="button">CLOSE</button>
    </div>
    <div id="source-article-modal-content"></div>
  </div>
</div>
<div class="modal" id="evidence-modal">
  <div class="modal-card">
    <div class="modal-top">
      <div class="modal-title">EVIDENCE CARDS</div>
      <button class="reset-btn" id="evidence-close-btn" type="button">CLOSE</button>
    </div>
    <div id="evidence-filter-bar" class="field-group"></div>
    <div class="card-list" id="evidence-modal-content"></div>
  </div>
</div>
<div class="modal" id="claims-modal">
  <div class="modal-card">
    <div class="modal-top">
      <div class="modal-title">CLAIMS LEDGER</div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="reset-btn" id="claims-copy-btn" type="button">COPY</button>
        <button class="reset-btn" id="claims-close-btn" type="button">CLOSE</button>
      </div>
    </div>
    <div class="mono-block" id="claims-modal-content"></div>
  </div>
</div>
<div class="modal" id="outline-modal">
  <div class="modal-card">
    <div class="modal-top">
      <div class="modal-title">OUTLINE FROM MAP</div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="reset-btn" id="outline-copy-btn" type="button">COPY</button>
        <button class="reset-btn" id="outline-close-btn" type="button">CLOSE</button>
      </div>
    </div>
    <div class="mono-block" id="outline-modal-content"></div>
  </div>
</div>
<div class="modal" id="critique-modal">
  <div class="modal-card">
    <div class="modal-top">
      <div class="modal-title">RED-TEAM CRITIQUE</div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="reset-btn" id="critique-copy-btn" type="button">COPY</button>
        <button class="reset-btn" id="critique-close-btn" type="button">CLOSE</button>
      </div>
    </div>
    <div class="mono-block" id="critique-modal-content"></div>
  </div>
</div>
<div class="modal" id="replication-modal">
  <div class="modal-card">
    <div class="modal-top">
      <div class="modal-title">REPLICATION RESULTS</div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="reset-btn" id="replication-close-btn" type="button">CLOSE</button>
      </div>
    </div>
    <div class="mono-block" id="replication-modal-content"></div>
  </div>
</div>
<script type="module" src="js/main.js"></script>
</body>
</html>
